#!/bin/bash
# Post-compile script to reduce slug size on Heroku

echo "ðŸ§¹ Cleaning up to reduce slug size..."

# Remove TensorFlow examples and unnecessary files
find . -type d -name "examples" -exec rm -rf {} + 2>/dev/null || true
find . -type d -name "tests" -path "*/site-packages/*" -exec rm -rf {} + 2>/dev/null || true
find . -type f -name "*.md" -path "*/site-packages/*" -delete 2>/dev/null || true
find . -type f -name "README*" -path "*/site-packages/*" -delete 2>/dev/null || true
find . -type f -name "LICENSE*" -path "*/site-packages/*" -delete 2>/dev/null || true
find . -type f -name "CHANGELOG*" -path "*/site-packages/*" -delete 2>/dev/null || true

# Remove __pycache__ directories
find . -type d -name "__pycache__" -exec rm -rf {} + 2>/dev/null || true

# Remove .pyc files
find . -type f -name "*.pyc" -delete 2>/dev/null || true
find . -type f -name "*.pyo" -delete 2>/dev/null || true

# Remove test files in site-packages
find . -type f -name "*_test.py" -path "*/site-packages/*" -delete 2>/dev/null || true
find . -type f -name "test_*.py" -path "*/site-packages/*" -delete 2>/dev/null || true

# Remove TensorFlow unnecessary components if they exist
if [ -d ".heroku/python/lib/python*/site-packages/tensorflow/examples" ]; then
    rm -rf .heroku/python/lib/python*/site-packages/tensorflow/examples
fi

if [ -d ".heroku/python/lib/python*/site-packages/tensorflow/tools" ]; then
    rm -rf .heroku/python/lib/python*/site-packages/tensorflow/tools
fi

# Remove documentation directories
find . -type d -name "docs" -path "*/site-packages/*" -exec rm -rf {} + 2>/dev/null || true
find . -type d -name "doc" -path "*/site-packages/*" -exec rm -rf {} + 2>/dev/null || true

echo "âœ… Cleanup complete!"

